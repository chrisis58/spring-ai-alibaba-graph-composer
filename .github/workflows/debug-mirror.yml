name: Debug Mirror Config

on:
  workflow_dispatch:

jobs:
  test-mirror-download:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Check if custom settings exists
        run: |
          if [ -f ".github/ci-settings.xml" ]; then
            echo "âœ… Custom settings file found!"
            cat .github/ci-settings.xml
          else
            echo "âŒ Error: .github/ci-settings.xml not found!"
            exit 1
          fi

      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'
          # cache: 'maven'

      # å¦‚æœè¿™ä¸€æ­¥ç»¿äº†ï¼Œè¯´æ˜ Google é•œåƒç”Ÿæ•ˆäº†ï¼Œ403 é—®é¢˜è§£å†³
      - name: Test Download with Mirror
        run: |
          echo "ğŸš€ Starting dependency resolution using Google Mirror..."
          mvn dependency:resolve -Drevision=0.0.1-TEST \
          -s .github/ci-settings.xml \
          -e
        env:
          MAVEN_CENTRAL_USERNAME: ${{ secrets.CENTRAL_USERNAME }}
          MAVEN_CENTRAL_TOKEN: ${{ secrets.CENTRAL_TOKEN }}

      - name: Verify Effective Settings
        run: mvn help:effective-settings -s .github/ci-settings.xml
        env:
          MAVEN_CENTRAL_USERNAME: ${{ secrets.CENTRAL_USERNAME }}
          MAVEN_CENTRAL_TOKEN: ${{ secrets.CENTRAL_TOKEN }}
